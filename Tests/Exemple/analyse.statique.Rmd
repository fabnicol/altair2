
```{r }
# Conversion en Rmd: spin(..., knit = FALSE)  dans l'encodage du système (convertir ce fichier en UTF-8 sous linux)

# On revient à une analyse des rémunérations qui réinclut tous les personnels (vacataires, élus, inactifs, annexes)
```{r }
Analyse.rémunérations.exercice <- Analyse.rémunérations[Année == année]     
```

# `r chapitre`. Rémunérations brutes : analyse pour l'exercice `r année`   
## `r chapitre`.1 Masse salariale brute de l'ensemble des agents     

```{r }
masses.personnels <- Analyse.rémunérations.exercice[Statut != "ELU",
                                                    .(Montant.brut.annuel = sum(Montant.brut.annuel, na.rm = TRUE),                                                                                       rémunération.indemnitaire.imposable = sum(rémunération.indemnitaire.imposable, na.rm = TRUE),
                                                      indemnités.élu = sum(indemnités.élu, na.rm = TRUE),
                                                      total.lignes.paie = sum(total.lignes.paie, na.rm = TRUE),
                                                      autres.rémunérations = sum(autres.rémunérations, na.rm = TRUE))]
```

### Cumuls des rémunérations brutes pour l'exercice `r année`      
 
*Personnels (hors élus)*     
 
&nbsp;*Tableau `r incrément()`*   
   

```{r }
Tableau.vertical2(c("Agrégats",
                    "k&euro;"),
                  c("Brut annuel (bulletins)",
                    "Brut annuel (lignes) :",
                    "\\ dont \\ Primes :",
                    "\\ dont \\ Autres rémunérations",
                    "Part de primes en %"),
                  c(masses.personnels$Montant.brut.annuel,
                    masses.personnels$total.lignes.paie,
                    masses.personnels$rémunération.indemnitaire.imposable,
                    masses.personnels$autres.rémunérations,
                    masses.personnels$rémunération.indemnitaire.imposable/masses.personnels$Montant.brut.annuel * 100))
```

 
**Définitions :**

 *Brut annuel (bulletins)*   : somme du champ *Brut*    
 *Brut annuel (lignes)*      : somme du champ *Montant* des lignes de paye, dont :    
 *Primes*                    : indemnités sauf remboursements, certaines IJSS, indemnités d'élu le cas échéant, Supplément familial de traitement et Indemnité de résidence        
 *Autres rémunérations*      : acomptes, retenues sur brut, rémunérations diverses, rappels   
 
**Tests de cohérence**

Somme des rémunérations brutes versées aux personnels (non élus) :  
 
 
&nbsp;*Tableau `r incrément()`*   
   

```{r }
Tableau.vertical2(c("Agrégats",
                    "k&euro;"),
                  c("Bulletins de paie ",
                    "Lignes de paie ",
                    "Différence "),
                  c(masses.personnels$Montant.brut.annuel,
                    masses.personnels$total.lignes.paie,
                    masses.personnels$Montant.brut.annuel -
                      masses.personnels$total.lignes.paie))
```


à comparer aux soldes des comptes 641 et 648 du compte de gestion.

  
## `r chapitre`.2 Masse salariale brute des fonctionnaires

*Cette section concerne les personnels fonctionnaires titulaires et stagiaires*  


```{r }
filtre.fonctionnaire <- function (X) X[ !is.na(X)  & X > minimum.positif ]

AR <- Analyse.rémunérations.exercice[Statut == "TITULAIRE" | Statut == "STAGIAIRE", 
                                     colonnes.sélectionnées,
                                     with=FALSE]

attach(AR)
source("histogrammes.R", encoding = encodage.code.source)
histogrammes()
detach(AR)
```

   
**Nota :**   
*EQTP : Equivalent temps plein = 12 . moyenne du ratio ratio rémunération / quotité*  
   
**Effectif : `r nrow(AR)`**

**Tests de cohérence**

```{r }
if (nrow(AR) > 0) {
  masses.fonct <- AR[ , lapply(.(Montant.brut.annuel, rémunération.indemnitaire.imposable, total.lignes.paie, autres.rémunérations), sum, na.rm = TRUE)]
  
} else {
  masses.fonct <- c(0,0) 
}
```

Somme des rémunérations brutes versées aux personnels titulaires et stagiaires :

 
&nbsp;*Tableau `r incrément()`*   
   

```{r }
Tableau.vertical2(c("Agrégats",
                    "k&euro;"),
                  c("Brut annuel (bulletins)",
                    "Brut annuel (lignes) : ",
                    "\\ dont \\ \\ primes :",
                    "\\ dont \\ autres rémunérations :",
                    "Part de primes en %"),
                  c(masses.fonct[[1]],  
                    masses.fonct[[3]],
                    masses.fonct[[2]],
                    masses.fonct[[4]],
                    masses.fonct[[2]]/masses.fonct[[1]] * 100))
```


**Définitions :**

 *Brut annuel (bulletins)*   : somme du champ *Brut*   
 *Brut annuel (lignes)*      : somme du champ *Montant* des lignes de paye, dont :   
 *Primes*                    : indemnités sauf remboursements, certaines IJSS, Supplément familial de traitement et Indemnité de résidence       
 *Autres rémunérations*      : acomptes, retenues sur brut, rémunérations diverses, rappels   

**Tests de cohérence**

Somme des rémunérations brutes versées aux personnels (fonctionnaires) :

 
&nbsp;*Tableau `r incrément()`*   
   

```{r }
Tableau.vertical2(c("Agrégats",
                    "k&euro;"),
                  c("Bulletins de paie ",
                    "Lignes de paie ",
                    "Différence "),
                  c(masses.fonct[[1]],  # Brut
                    masses.fonct[[3]],  # lignes
                    masses.fonct[[1]] -
                      masses.fonct[[3]]))
```


A comparer aux soldes des comptes 6411, 6419 et 648 du compte de gestion.

**Formation et distribution du salaire brut moyen par tête (SMPT) en EQTP pour l'année `r année`**     
 
&nbsp;*Tableau `r incrément()`*   
   

```{r }
Résumé(c("Traitement indiciaire",
         "Primes",
         "Autres rémunérations",
         "Effectif"),
       AR[Grade != "V" & Grade != "A" & Statut != "ELU"
          & Filtre_actif == TRUE
          & Filtre_annexe == FALSE,
             .(traitement.indiciaire,
               rémunération.indemnitaire.imposable,
               autres.rémunérations)],
       
       extra = "length")
```

 
&nbsp;*Tableau `r incrément()`*   
   

```{r }
Résumé(c("Total lignes hors rappels",
         "Total brut",
         "SMPT brut en EQTP",
         "Part de la rém. indemnitaire",
         "Effectif"),
       AR[Grade != "V" & Grade != "A" & Statut != "ELU"
          & Filtre_actif == TRUE
          & Filtre_annexe == FALSE,
          .(total.lignes.paie,
                                                                                             Montant.brut.annuel,
                                                                                             Montant.brut.annuel.eqtp,
                                                                                             part.rémunération.indemnitaire)],
       extra = "length")
```

  
*Hors vacataires identifiés, assistantes maternelles, élus locaux et pour les postes actifs non annexes*  

**Catégorie A**


```{r }
ARA <- data.table::data.table(NULL)
ARB <- data.table::data.table(NULL)
ARC <- data.table::data.table(NULL)
```

 
&nbsp;*Tableau `r incrément()`*   
   

```{r }
if (analyse.par.catégorie) {

  ARA <- AR[Catégorie == "A" & Grade != "V" & Grade != "A" & Statut != "ELU" 
            & Filtre_actif == TRUE
            & Filtre_annexe == FALSE, ]
  
  Résumé(c("Traitement indiciaire",
           "Primes",
           "Autres rémunérations"),
         ARA[ , .(traitement.indiciaire,
                  rémunération.indemnitaire.imposable,
                  autres.rémunérations)])
} else {
  cat("Pas de statistiques par catégorie.\n")
}
```


 
&nbsp;*Tableau `r incrément()`*   
   

```{r }
if (analyse.par.catégorie) {  
  Résumé(c("Total rémunérations", 
           "Total rémunérations EQTP", 
           "Part de la rémunération indemnitaire"),
         ARA[ , .(Montant.brut.annuel,
                  Montant.brut.annuel.eqtp,
                  part.rémunération.indemnitaire)])

} else {
  cat("Pas de statistiques par catégorie.\n")
}
```


**Effectif : `r nrow(ARA)`**  

**Catégorie B**

 
&nbsp;*Tableau `r incrément()`*   
   

```{r }
if (analyse.par.catégorie) {
  ARB <- AR[Catégorie == "B" & Grade != "V" & Grade != "A" & Statut != "ELU"
            & Filtre_actif == TRUE
            & Filtre_annexe == FALSE, ]
  
  Résumé(c("Traitement indiciaire",
           "Primes",
           "Autres rémunérations"),
         ARB[, .(traitement.indiciaire,
                 rémunération.indemnitaire.imposable,
                 autres.rémunérations)])
} else {
  cat("Pas de statistiques par catégorie.\n")
}
```


 
&nbsp;*Tableau `r incrément()`*   
   

```{r }
if (analyse.par.catégorie) {
  
  Résumé(c("Total rémunérations",
           "Total rémunérations EQTP",
           "Part de la rémunération indemnitaire"),
         ARB[, .(Montant.brut.annuel,
                 Montant.brut.annuel.eqtp,
                 part.rémunération.indemnitaire)])
} else {
  cat("Pas de statistiques par catégorie.\n")
}
```


**Effectif : `r nrow(ARB)`**

**Catégorie C**

 
&nbsp;*Tableau `r incrément()`*   
   

```{r }
if (analyse.par.catégorie) {
  ARC <- AR[Catégorie == "C" & Grade != "V" & Grade != "A" & Statut != "ELU" 
            & Filtre_actif == TRUE
            & Filtre_annexe == FALSE, ]
  
  Résumé(c("Traitement indiciaire",
           "Primes",
           "Autres rémunérations"),
         ARC[ , .(traitement.indiciaire,
                  rémunération.indemnitaire.imposable,
                  autres.rémunérations)])
} else {
  cat("Pas de statistique par catégorie.\n")
}
```


 
&nbsp;*Tableau `r incrément()`*   
   

```{r }
if (analyse.par.catégorie) {
  
  Résumé(c("Total rémunérations",
           "Total rémunérations EQTP",
           "Part de la rémunération indemnitaire"),
         ARC[ , .(Montant.brut.annuel,
                  Montant.brut.annuel.eqtp,
                  part.rémunération.indemnitaire) ])
} else {
  cat("Pas de statistiques par catégorie.\n")
}
```

**Effectif : `r nrow(ARC)`**


######      <br>

## `r chapitre`.3 Contractuels, vacataires et stagiaires inclus   
  
*Les assistantes maternelles et les vacataires sont ici inclus, pour les postes non annexes*   


```{r }
attach(Analyse.rémunérations.exercice, warn.conflicts=FALSE)
temp <- rémunération.indemnitaire.imposable.eqtp[Statut != "ELU"
                                                 & Statut != "TITULAIRE"
                                                 & Statut != "STAGIAIRE"
                                                 & Filtre_actif == TRUE
                                                 & Filtre_annexe == FALSE
                                                 & rémunération.indemnitaire.imposable.eqtp > 1000] / 1000

if (longueur.non.na(temp) > 0)
  hist(temp,
       xlab = "Rémunération indemnitaire brute imposable en milliers d'euros EQTP\n",
       ylab = "Effectif",
       xlim = c(0, 40),
       main = "Rémunération annuelle totale des contractuels en " %+% année,
       col = "red",
       nclass = 50)
```

  
**Nota :**
Ne sont retenues que les rémunérations supérieures à 1 000 k&euro;.
Les élus ne sont pas pris en compte.
  

```{r }
temp <- positive(autres.rémunérations)

detach(Analyse.rémunérations.exercice)

if (longueur.non.na(temp))
  hist(temp,
       xlab = "En euros :\n divers",
       ylab = "Effectif",
       xlim = c(0, 5000),
       main = "Autres rémunérations en " %+% année,
       nclass = 50,
       col = "grey")
```



```{r }
AR <- Analyse.rémunérations.exercice[Statut != "ELU"
                                             &  Statut != "TITULAIRE"
                                             &  Statut != "STAGIAIRE"
                                             & Filtre_actif == TRUE
                                             & Filtre_annexe == FALSE,
                                             colonnes.sélectionnées, 
                                             with=FALSE]
```

  
**Formation et distribution du salaire brut moyen par tête (SMPT) en EQTP pour l'année `r année`**     
  
 
&nbsp;*Tableau `r incrément()`*   
   

```{r }
Résumé(c("Primes",
         "Autres rémunérations",
         "Effectif"),
       AR[ , .(rémunération.indemnitaire.imposable,
               autres.rémunérations)],
       extra = "length")
```

 
&nbsp;*Tableau `r incrément()`*   
   

```{r }
Résumé(c("Total rémunérations",
         "Total rémunérations EQTP",
         "Effectif"),
       AR[ , .(Montant.brut.annuel, Montant.brut.annuel.eqtp)],
       extra = "length")
```



```{r }
# pour année fin #

rm(Analyse.rémunérations.exercice)
```

